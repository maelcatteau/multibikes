<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extension de la vue formulaire des commandes de vente -->
    <record id="view_sale_order_form_inherit_multibikes" model="ir.ui.view">
        <field name="name">sale.order.form.inherit.multibikes</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <!-- Ajout du champ de numéro de caution dans la section des détails du partenaire -->
            <!-- Ce champ permet de faire le lien avec l'empreinte de carte' -->
            <xpath expr="//group[@name='partner_details']" position="inside">
                <field name="mb_type_de_caution"/>
                <field name="mb_numero_de_caution" invisible="mb_type_de_caution != 'carte_bancaire'"/>
            </xpath>
            
            <!-- Ajout des champs dans les lignes de commande - vue liste -->
            <xpath expr="//notebook/page[@name='order_lines']/field/list/field[@name='price_unit']" position="after">
                <field name="mb_caution_unit"/>
                <field name="mb_value_in_case_of_theft"/>
            </xpath>
            <xpath expr="//notebook/page[@name='order_lines']/field/list/field[@name='price_subtotal']" position="after">
                <field name="mb_caution_subtotal"/>
            </xpath>

            <!-- Ajout des champs dans les lignes de commande - vue formulaire (popup) -->
            <xpath expr="//field[@name='order_line']//form//field[@name='price_unit']" position="after">
                <field name="mb_caution_unit"/>
                <field name="mb_value_in_case_of_theft"/>
            </xpath>
            <xpath expr="//field[@name='order_line']//form//field[@name='price_subtotal']" position="after">
                <field name="mb_caution_subtotal"/>
            </xpath>

            <!-- Ajout du champ de caution totale -->
            <xpath expr="//group[@name='sale_total']" position="inside">
                <field name="mb_caution_total" 
                    class="oe_subtotal_footer_separator" 
                    widget="monetary" 
                    string="Caution Totale"/>
            </xpath>
        </field>
    </record>
</odoo>
