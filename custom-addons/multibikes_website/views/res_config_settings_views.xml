<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vue list pour mb.renting.stock.period.config -->
    <record id="view_mb_renting_stock_period_config_list" model="ir.ui.view">
        <field name="name">mb.renting.stock.period.config.list</field>
        <field name="model">mb.renting.stock.period.config</field>
        <field name="arch" type="xml">
            <list editable="bottom">
                <!-- Le champ period_id est invisible mais toujours pr√©sent pour le filtrage -->
                <field name="period_id" invisible="1"/>
                <field name="storable_product_ids" widget="many2many_tags" options="{'no_create': True}" string="Produits stockables"/>
                <field name="total_stock_by_product" string="D√©tail du stock par produit"/>
                <!-- √âlargit la colonne en d√©finissant une largeur sp√©cifique -->
                <field name="stock_available_for_period" string="Stock disponible pour la p√©riode" width="200"/>
                <!-- Ajout du compteur de produits stockables -->
                <field name="storable_product_count" string="Nb produits configur√©s"/>
            </list>
        </field>
    </record>
    
    <!-- Vue form pour mb.renting.stock.period.config -->
    <record id="view_mb_renting_period_form" model="ir.ui.view">
        <field name="name">mb.renting.period.form</field>
        <field name="model">mb.renting.period</field>
        <field name="arch" type="xml">
            <form>
                <!-- HEADER avec statut et boutons -->
                <header>
                    <field name="status" widget="statusbar" 
                        statusbar_visible="future,active,past,closed"/>
                    <button name="action_create_next_period" 
                            string="Cr√©er p√©riode suivante" 
                            type="object" 
                            class="btn-primary"
                            invisible="status != 'active'"/>
                </header>
                
                <!-- SHEET principal -->
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Nom de la p√©riode..."/>
                        </h1>
                    </div>
                    
                    <!-- INFORMATIONS PRINCIPALES -->
                    <group>
                        <group string="üìÖ Dates">
                            <field name="start_date" 
                                widget="datetime"
                                readonly="id != False"
                                placeholder="Auto-calcul√© depuis la p√©riode pr√©c√©dente"/>
                            <field name="end_date" widget="datetime"/>
                            <field name="is_closed"/>
                            <field name="company_id" groups="base.group_multi_company"/>
                        </group>
                        
                        <group string="‚öôÔ∏è Configuration">
                            <field name="recurrence_id" 
                                options="{'no_create': True, 'no_edit': True}"/>
                            <field name="recurrence_name" readonly="1"/>
                            <field name="recurrence_duration" readonly="1"/>
                            <field name="recurrence_unit" readonly="1"/>
                        </group>
                    </group>
                    
                    <!-- INDICATEURS KPI -->
                    <group string="üìä Indicateurs">
                        <group>
                            <field name="total_storable_products" 
                                string="üéØ Total produits stockables" 
                                readonly="1"/>
                            <field name="remaining_products_to_configure" 
                                string="‚ö†Ô∏è Produits restants √† configurer" 
                                readonly="1"
                                invisible="remaining_products_to_configure == 0"/>
                        </group>
                        <group>
                            <!-- Alerte si produits non configur√©s -->
                            <div class="alert alert-warning" 
                                invisible="remaining_products_to_configure == 0"
                                role="alert">
                                <strong>‚ö†Ô∏è Configuration incompl√®te</strong><br/>
                                <field name="remaining_products_to_configure" readonly="1" nolabel="1"/> 
                                produit(s) restant(s) √† configurer dans l'onglet "Configuration des stocks".
                            </div>
                            
                            <!-- Message de succ√®s si tout est configur√© -->
                            <div class="alert alert-success" 
                                invisible="remaining_products_to_configure != 0"
                                role="alert">
                                <strong>‚úÖ Configuration compl√®te</strong><br/>
                                Tous les produits stockables sont configur√©s !
                            </div>
                        </group>
                    </group>
                    
                        <!-- ONGLETS -->
                        <notebook>
                             <page string="üïí Configuration des jours" name="day_config">
                                <div class="o_setting_box">
                                    <div class="o_setting_left_pane">
                                        <button name="action_create_default_day_configs" 
                                                string="‚ö° Config. automatique jours" 
                                                type="object" 
                                                class="btn btn-primary oe_highlight"
                                                help="Cr√©e automatiquement la configuration pour tous les jours"/>
                                    </div>
                                </div>
                                <field name="day_configs" 
                                    context="{'default_company_id': company_id, 'default_period_id': id}"
                                    nolabel="1">
                                    <list editable="bottom" view_ref="view_mb_renting_day_config_list"/>
                                </field>
                            </page>
                            
                            <page string="üì¶ Configuration des stocks" name="stock_config">
                                <div class="o_setting_box" invisible="remaining_products_to_configure == 0">
                                    <div class="o_setting_left_pane">
                                        <button name="action_auto_configure_all_products" 
                                                string="‚ö° Config. automatique stocks" 
                                                type="object" 
                                                class="btn btn-primary oe_highlight"
                                                help="Configure automatiquement tous les produits restants"/>
                                    </div>
                                </div>
                                <field name="stock_period_config_ids" 
                                    context="{'default_period_id': id}" 
                                    domain="[('period_id', '=', id)]"
                                    nolabel="1">
                                    <list editable="bottom">
                                        <field name="storable_product_ids" 
                                            widget="many2many_tags" 
                                            options="{'no_create': True}"
                                            placeholder="S√©lectionner des produits..."/>
                                        <field name="total_stock_by_product" 
                                            readonly="1"
                                            string="Stock total"/>
                                        <field name="stock_available_for_period" 
                                            string="Stock dispo p√©riode"/>
                                    </list>
                                </field>
                            </page>
                        </notebook>
                </sheet>
            </form>
        </field>
    </record>

    
    <!-- Vue list pour mb.renting.day.config (d√©j√† en list, gard√©e pour r√©f√©rence) -->
    <record id="view_mb_renting_day_config_list" model="ir.ui.view">
        <field name="name">mb.renting.day.config.list</field>
        <field name="model">mb.renting.day.config</field>
        <field name="arch" type="xml">
            <list editable="bottom">
                <field name="day_of_week"/>
                <field name="is_open"/>
                <field name="allow_pickup" invisible="not is_open"/>
                <field name="pickup_hour_from" widget="float_time" invisible="not is_open or not allow_pickup"/>
                <field name="pickup_hour_to" widget="float_time" invisible="not is_open or not allow_pickup"/>
                <field name="allow_return" invisible="not is_open"/>
                <field name="return_hour_from" widget="float_time" invisible="not is_open or not allow_return"/>
                <field name="return_hour_to" widget="float_time" invisible="not is_open or not allow_return"/>
            </list>
        </field>
    </record>   

    <record id="res_config_settings_view_form_rental_periods" model="ir.ui.view">
        <field name="name">res.config.settings.view.form.inherit.rental.periods</field>
        <field name="model">res.config.settings</field>
        <field name="inherit_id" ref="sale_renting.res_config_settings_view_form"/>
        <field name="arch" type="xml">
            <!-- Supprimer tout le bloc "Rent Online" et le remplacer par notre contenu personnalis√© -->
            <xpath expr="//block[@id='sale_renting_product_settings']" position="replace">
                <block title="Rent Online" id="sale_renting_product_settings">
                    <h2>Configuration des p√©riodes de location</h2>
                    <div class="row mt16 o_settings_container" id="rental_seasonal_settings">
                        <div class="col-12 col-lg-12 o_setting_box">
                            <div class="o_setting_right_pane">
                                <span class="o_form_label">P√©riodes de location</span>
                                <div class="text-muted">
                                    D√©finir les p√©riodes de location et leurs configurations associ√©es
                                </div>
                                <div class="content-group">
                                    <div class="mt16">
                                        <field name="renting_periods" context="{'default_company_id': company_id}"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </block>
            </xpath>
        </field>
    </record>
</odoo>
